# راهنمای سیستم محدودیت‌های قابل پیکربندی (Limits System Guide)

سیستم محدودیت‌های `ChatEngine` یک ویژگی قدرتمند است که به توسعه‌دهندگان اجازه می‌دهد تا رفتار و محدودیت‌های برنامه را بر اساس محیط اجرایی (مانند وب، افزونه IDE یا اپلیکیشن موبایل) سفارشی‌سازی کنند. این سیستم انعطاف‌پذیری بالایی را برای کنترل مصرف منابع، اعتبارسنجی ورودی‌ها و تجربه کاربری فراهم می‌کند.

## ۱. فلسفه طراحی

به جای داشتن مقادیر ثابت (Hardcoded) در کد، تمام محدودیت‌ها در یک مکان مرکزی (`js/utils/constants.js`) تعریف شده‌اند. `ChatEngine` هنگام راه‌اندازی، این محدودیت‌ها را بارگذاری کرده و در اختیار تمام ماژول‌های خود قرار می‌دهد. این رویکرد به شما اجازه می‌دهد تا با یک تغییر کوچک در هنگام نمونه‌سازی `ChatEngine`، کل رفتار برنامه را تغییر دهید.

## ۲. نحوه کارکرد

سیستم بر پایه دو مفهوم اصلی استوار است:

1.  **`DEFAULT_LIMITS`**: یک آبجکت پایه که شامل تمام مقادیر پیش‌فرض برای هر محدودیت ممکن در برنامه است. اگر هیچ پیکربندی خاصی ارائه نشود، از این مقادیر استفاده می‌شود.

2.  **`PRESET_LIMITS`**: شامل مجموعه‌ای از پیش‌تنظیم‌های آماده برای محیط‌های مختلف است. هر پیش‌تنظیم، مقادیر پیش‌فرض را برای مطابقت با نیازهای آن محیط خاص بازنویسی (Override) می‌کند.
    -   `web` (پیش‌فرض): تنظیمات متعادل برای استفاده عمومی در وب.
    -   `ide`: محدودیت‌های بالاتر برای استفاده در محیط‌های توسعه (مانند افزونه VS Code) که معمولاً منابع بیشتری دارند.
    -   `mobile`: محدودیت‌های پایین‌تر برای بهینه‌سازی مصرف داده و حافظه در دستگاه‌های موبایل.
    -   `unlimited`: تمام محدودیت‌ها را غیرفعال می‌کند. مفید برای توسعه یا استفاده‌های خاص.

هنگام راه‌اندازی `ChatEngine`، متد `mergeLimits` به صورت خودکار پیکربندی ارائه‌شده را با مقادیر پیش‌فرض ادغام کرده و نتیجه نهایی را در `this.engine.limits` ذخیره می‌کند.

## ۳. نحوه پیکربندی

شما می‌توانید محدودیت‌ها را به دو روش هنگام نمونه‌سازی `ChatEngine` مشخص کنید:

### استفاده از یک پیش‌تنظیم (Preset)

ساده‌ترین روش، استفاده از نام یکی از پیش‌تنظیم‌های موجود است:

```javascript
// در فایل js/main.js
import ChatEngine from './core/chatEngine.js';

const chatEngine = new ChatEngine({
    storage: IndexedDBStorage,
    providers: { /* ... */ },
    limits: 'mobile' // <--- استفاده از پیش‌تنظیم موبایل
});
```

### استفاده از یک آبجکت سفارشی

شما می‌توانید یک آبجکت با مقادیر دلخواه خود ارسال کنید. این مقادیر با پیش‌فرض‌ها ترکیب می‌شوند، بنابراین فقط کافی است مقادیری را که می‌خواهید تغییر دهید، مشخص کنید.

```javascript
// در فایل js/main.js
import ChatEngine from './core/chatEngine.js';

const customLimits = {
    maxChats: 50,
    file: {
        maxOriginalFileSizeBytes: 5 * 1024 * 1024, // 5 MB
        allowedMimeTypes: ['image/jpeg', 'image/png']
    },
    image: {
        maxFinalDimension: 800
    }
};

const chatEngine = new ChatEngine({
    storage: IndexedDBStorage,
    providers: { /* ... */ },
    limits: customLimits // <--- استفاده از پیکربندی سفارشی
});
```

## ۴. مرجع کامل محدودیت‌ها

در ادامه لیست تمام محدودیت‌های قابل پیکربندی و کاربرد آن‌ها آمده است.

### محدودیت‌های عمومی

| نام ویژگی             | نوع     | پیش‌فرض    | توضیحات                                                                   |
| ---------------------- | ------- | ---------- | ------------------------------------------------------------------------- |
| `maxMessageLength`     | `number`  | `50000`    | حداکثر تعداد کاراکترهای مجاز در یک پیام متنی.                          |
| `maxChatTitleLength`   | `number`  | `100`      | حداکثر طول مجاز برای عنوان یک گپ.                                         |
| `maxChats`             | `number`  | `Infinity` | حداکثر تعداد گپ‌هایی که کاربر می‌تواند ایجاد کند.                         |
| `maxMessagesPerChat`   | `number`  | `Infinity` | حداکثر تعداد پیام‌هایی که می‌توان در یک گپ ارسال کرد.                      |

### محدودیت‌های فایل (`file`)

| نام ویژگی                   | نوع       | پیش‌فرض                          | توضیحات                                                                          |
| --------------------------- | ---------- | -------------------------------- | --------------------------------------------------------------------------------- |
| `maxOriginalFileSizeBytes`  | `number`   | `10485760` (10MB)                | حداکثر حجم مجاز فایل اصلی (قبل از فشرده‌سازی).                                  |
| `maxCompressedSizeBytes`    | `number`   | `4194304` (4MB)                  | حداکثر حجم مجاز فایل پس از فشرده‌سازی.                                           |
| `allowedMimeTypes`          | `string[]` | `['image/jpeg', ...]`            | آرایه‌ای از انواع MIME مجاز برای آپلود. `['*/*']` یعنی همه انواع مجاز هستند.     |
| `allowedExtensions`         | `string[]` | `['jpg', 'jpeg', ...]`           | آرایه‌ای از پسوندهای فایل مجاز. `['*']` یعنی همه پسوندها مجاز هستند.            |

### محدودیت‌های تصویر (`image`)

این محدودیت‌ها در فرآیند فشرده‌سازی تصویر اعمال می‌شوند.

| نام ویژگی                | نوع     | پیش‌فرض    | توضیحات                                                                            |
| ------------------------- | -------- | ---------- | ---------------------------------------------------------------------------------- |
| `maxOriginalDimension`    | `number`   | `4096`     | حداکثر طول یا عرض مجاز برای تصویر اصلی (قبل از فشرده‌سازی).                     |
| `maxFinalDimension`       | `number`   | `1200`     | حداکثر طول یا عرض تصویر پس از تغییر اندازه (Resize).                               |
| `compressionQuality`      | `number`   | `0.8`      | کیفیت فشرده‌سازی تصویر (عددی بین 0 و 1). فقط برای فرمت‌های JPEG و WebP.            |
| `maxAspectRatio`          | `number`   | `10.0`     | حداکثر نسبت ابعاد مجاز (طول به عرض یا برعکس) برای جلوگیری از تصاویر خیلی باریک یا پهن. |
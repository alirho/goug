# معماری کامپوننت‌ها (Component Architecture)

افزونه WebUI از یک معماری ماژولار اما ساده استفاده می‌کند. برخلاف فریم‌ورک‌هایی مثل React یا Vue، این افزونه مستقیماً با DOM مرورگر کار می‌کند تا بالاترین کارایی را داشته باشد.

---

## ۱. مدیر رابط کاربری (`UIManager`)

این کلاس مغز متفکر رابط کاربری است.
*   **نقش**: هماهنگی بین هسته پیک (`Peik Core`) و کامپوننت‌های بصری.
*   **مسئولیت‌ها**:
    *   بارگذاری قالب‌های HTML اولیه (`mainLayout`).
    *   نمونه‌سازی از کامپوننت‌های فرزند (Sidebar, MessageList, ...).
    *   گوش دادن به رویدادهای هسته (مثل `chat:created`, `message`) و هدایت آن‌ها به کامپوننت مربوطه.
    *   مدیریت تغییر گپ فعال (`switchChat`).

---

## ۲. اجزای صفحه (Components)

هر بخش از صفحه توسط یک کلاس مجزا مدیریت می‌شود. این کلاس‌ها معمولاً یک المان DOM پدر (Container) دریافت می‌کنند و محتوای آن را مدیریت می‌کنند.

### نوار کناری (`Sidebar`)
*   لیست چت‌ها را نمایش می‌دهد.
*   گپ فعال را هایلایت می‌کند.
*   منوی عملیات (سه نقطه) برای **حذف** و **تغییر نام** گپ را مدیریت می‌کند.
*   دکمه "گپ جدید" را مدیریت می‌کند.

### لیست پیام‌ها (`MessageList`)
*   مسئول نمایش تاریخچه پیام‌ها است.
*   پیام‌های متنی را با استفاده از `MarkdownService` رندر می‌کند.
*   تصاویر را به صورت Base64 نمایش می‌دهد.
*   قابلیت **Streaming** را مدیریت می‌کند (اضافه کردن تدریجی متن به حباب پیام).
*   اسکرول خودکار به پایین صفحه را انجام می‌دهد.

### ناحیه ورودی (`InputArea`)
*   شامل کادر متنی (Textarea) و دکمه ارسال است.
*   مدیریت انتخاب فایل تصویر (Input File مخفی) و نمایش پیش‌نمایش (Thumbnail) قبل از ارسال.
*   ارسال پیام به هسته از طریق متد `chat.sendMessage`.

### مودال تنظیمات (`SettingsModal`)
*   فرم پیکربندی کلیدهای API و مدل‌ها را نمایش می‌دهد.
*   تنظیمات را اعتبارسنجی کرده و در هسته ذخیره می‌کند (`peik.updateSettings`).
*   مدیریت رابط کاربری پیچیده (آکاردئون‌ها و فرم‌های پویا برای مدل‌های سفارشی).

### مدیر لایت‌باکس (`LightboxManager`)
*   یک کامپوننت کاربردی کوچک است.
*   وقتی روی تصویری در چت کلیک می‌شود، آن را در یک لایه تمام صفحه (Overlay) نمایش می‌دهد.
*   با دکمه بستن یا کلید ESC بسته می‌شود.

---

## ۳. ابزارها (Utils)

### `TemplateLoader`
مسئول بارگذاری فایل‌های HTML از پوشه `templates` است. قابلیت ترکیب کردن فایل‌های کوچکتر (Partials) در فایل اصلی را دارد تا کد HTML تمیز بماند.

### `MarkdownService`
یک Wrapper دور کتابخانه `markdown-it` است. این سرویس متن خام را گرفته و HTML امن و فرمت‌دهی شده تحویل می‌دهد.

<!DOCTYPE html>
<html class="dark" dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Ù¾ÛŒÚ© - Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ</title>
    
    <link rel="icon" type="image/svg+xml" href="assets/images/logo.svg" />

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700;900&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>

    <!-- WebUI Plugin Styles -->
    <link rel="stylesheet" href="plugins/presentation/webUI/styles/main.css">
</head>
<body>
    <div id="root"></div>
    
    <!-- Main Application Script (Module) -->
    <script type="module">
        import { Peik } from './core/src/index.js';
        import IndexedDBStorage from './plugins/platform/indexeddbStorage/index.js';
        import FetchHttp from './plugins/platform/fetchHttp/index.js';
        import GeminiProvider from './plugins/core/geminiProvider/index.js';
        import OpenAIProvider from './plugins/core/openaiProvider/index.js';
        import WebUIPlugin from './plugins/presentation/webUI/index.js';

        (async () => {
            try {
                console.log('ğŸš€ Ø¯Ø± Ø­Ø§Ù„ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù¾ÛŒÚ©...');
                const peik = new Peik();

                // Û±. Ø«Ø¨Øª Ø§ÙØ²ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ±Ø³Ø§Ø®ØªÛŒ
                await peik.use(new IndexedDBStorage());
                await peik.use(new FetchHttp());

                // Û². Ø«Ø¨Øª Ø§Ø±Ø§Ø¦Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù† Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
                await peik.use(new GeminiProvider());
                await peik.use(new OpenAIProvider());

                // Û³. Ø«Ø¨Øª Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ (Ù…ØªØµÙ„ Ø¨Ù‡ div#root)
                await peik.use(new WebUIPlugin('root'));

                // Û´. Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù†Ù‡Ø§ÛŒÛŒ
                await peik.init();
                console.log('âœ… Ù¾ÛŒÚ© Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯.');

            } catch (error) {
                console.error("âŒ Ø®Ø·Ø§ÛŒ Ù…Ù‡Ù„Ú© Ø¯Ø± Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ:", error);
                const root = document.getElementById('root');
                if (root) {
                    root.innerHTML = `
                        <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;color:#ef4444;font-family:'Vazirmatn',sans-serif;text-align:center;padding:20px;">
                            <span class="material-symbols-outlined" style="font-size:48px;margin-bottom:16px;">error</span>
                            <h2>Ø®Ø·Ø§ Ø¯Ø± Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡</h2>
                            <p style="direction:ltr;background:#eee;padding:10px;border-radius:5px;margin-top:10px;color:#333;">${error.message}</p>
                        </div>
                    `;
                }
            }
        })();
    </script>
</body>
</html>